((self||this)["webpackJsonp@sprinklr/chat-web-client"]=(self||this)["webpackJsonp@sprinklr/chat-web-client"]||[]).push([[49],{1086:function(e,t,r){"use strict";var n=r(365);const c=r.n(n).a.createContext(void 0);t.a=c},1087:function(e,t,r){var n=r(121),c=r(1583),a=r(119),s=r(181),i=r(1584),u=r(461),o=s((function(e){var t=u(e),r=n(e,i);return t===u(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?c(r,a(t,2)):[]}));e.exports=o},1088:function(e,t,r){var n=r(121),c=r(119),a=r(1001),s=r(801);e.exports=function(e,t){if(null==e)return{};var r=n(s(e),(function(e){return[e]}));return t=c(t),a(e,r,(function(e,r){return t(e,r[0])}))}},1583:function(e,t,r){var n=r(187),c=r(720),a=r(809),s=r(121),i=r(123),u=r(188),o=Math.min;e.exports=function(e,t,r){for(var l=r?a:c,b=e[0].length,d=e.length,O=d,T=Array(d),E=1/0,v=[];O--;){var _=e[O];O&&t&&(_=s(_,i(t))),E=o(_.length,E),T[O]=!r&&(t||b>=120&&_.length>=120)?new n(O&&_):void 0}_=e[0];var h=-1,p=T[0];e:for(;++h<b&&v.length<E;){var I=_[h],m=t?t(I):I;if(I=r||0!==I?I:0,!(p?u(p,m):l(v,m,r))){for(O=d;--O;){var j=T[O];if(!(j?u(j,m):l(e[O],m,r)))continue e}p&&p.push(m),v.push(I)}}return v}},1584:function(e,t,r){var n=r(193);e.exports=function(e){return n(e)?e:[]}},1858:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Zt}));var n=r(365),c=r.n(n),a=r(473),s=r.n(a),i=r(366),u=r(74),o=r.n(u),l=r(503),b=r.n(l),d=r(533),O=r.n(d),T=r(460),E=r.n(T),v=r(537),_=r(469),h=r(1009),p=r(630),I=r(610),m=r(437),j=r(467);const g="IDLE",C="TRACKING";var f=()=>{const{subscribe:e}=Object(I.a)(),t=Object(n.useCallback)((()=>({eventType:j.a.PAGE_VISIT,eventId:c.current,details:{title:Object(m.c)(),oldUrl:c.current,newUrl:a.current}})),[]),r=Object(h.useFirstMountState)(),c=Object(n.useRef)(""),a=Object(n.useRef)(Object(m.b)()),{loading:s,refetch:i}=Object(p.a)({payload:t(),skipQueryOnMount:!1});return Object(n.useEffect)((()=>{const r=e("pageVisitTrackerInPrompt",(e=>{let{currentUrl:r,previousUrl:n}=e;c.current=n,a.current=r,i(t())}));return()=>{r&&r()}}),[i]),{trackingStatus:r||s?C:g}};var S=()=>{const{refetch:e}=Object(p.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{const{visibilityState:t}=document;e({eventType:j.a.TAB_CHANGE,eventId:Object(m.b)(),details:{isActive:"visible"===t}})};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}),[e])};var y=()=>{const{refetch:e}=Object(p.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:j.a.TAB_CLOSE,eventId:Object(m.b)(),details:{}})};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e])};var R=()=>(S(),y(),f()),N=r(406),A=r(415),L=r(10),P=r(477),k=r(507);const D=(new N.a).setUrl("/livechat/prompt/candidatePrompts").setType(A.a.POST).build(),w="ADD",V="REMOVE",U="RESET";var G=()=>{const{data:e,refetch:t,fetchMore:r,updateQuery:c}=Object(_.a)({query:D,skipQueryOnMount:!0,options:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),a=R().trackingStatus===g,[s,i]=Object(n.useState)(a?void 0:{isSilent:!1}),u=Object(n.useContext)(v.a),o=Object(n.useRef)(a);o.current=a;const l=Object(n.useCallback)((e=>{if(!o.current)return i({isSilent:e}),null;return t({...Object(m.a)(),appId:Object(L.a)().appId},e?(e,t)=>b()(t,(e=>{const t=u.getActionState(e.interceptId,e.id);return t!==k.a.CLOSE&&t!==k.a.ENGAGE&&t!==k.a.SNOOZE})):void 0)}),[t]),d=Object(n.useCallback)((e=>o.current?r({...Object(m.a)(),appId:Object(L.a)().appId,...e},((e,t)=>O()([...e,...t],"id"))):(i({isSilent:!1}),null)),[]);Object(n.useEffect)((()=>{a&&s&&(l(s.isSilent),i(void 0))}),[a,s]);return[e,Object(n.useCallback)((e=>{switch(e.type){case w:return d(e.payload);case V:{const t=new Set(E()(e.payload.interceptIds));return c((e=>b()(e,(e=>!t.has(P.a.getId(e)))))),null}case U:return l(e.payload.silent);default:return null}}),[c])]},x=r(851),M=r(941),H=r(424),F=r(117);const W=e=>`PROMPT_${H.a.getId(e)}_${Date.now()}_${Math.random().toString(16).substr(2,8)}`;let $;const B=()=>$,Q=()=>{B().disconnect().then((()=>{Object(F.a)("MQTT Client | Disconnected")})).catch((e=>{console.error("MQTT Client | Disconnection Error",e)}))};var Z=r(113),Y=r(489);const z="ADD_INTERCEPT",K="REMOVE_INTERCEPT";var J=(e,t)=>{const r=Object(n.useMemo)((()=>({chatUser:Y.a.getChatUser(t),userName:Y.a.getChatSessionToken(t),inboxServerUrl:Y.a.getProactiveInboxServerUrl(t),userInbox:Y.a.getProactiveUserInbox(t)})),[t.chatUser,t.chatSessionToken,t.proactivePromptInboxServerUrl,t.proactiveUserInbox]);Object(n.useEffect)((()=>{(e=>{let{chatUser:t,userName:r,inboxServerUrl:n,userInbox:c}=e;const a=W(t);$=new M.a({userName:r,clientId:a,inboxServerUrl:n,userInbox:c})})(r);try{(()=>{B().connect().catch((e=>{console.error("MQTT Client | Connection Error",e)}));const e=B();e.on("error",(()=>{Object(F.a)("MQTT Client | Error")})),e.on("offline",(()=>{Object(F.a)("MQTT Client | Offline")})),e.on("reconnect",(()=>{Object(F.a)("MQTT Client | Reconnect")})),e.on("close",(()=>{Object(F.a)("MQTT Client | Closed")}))})(),B().subscribe().catch((e=>{console.error("MQTT client | Subscribe Error",e)})),B().on("message",((t,r)=>{try{const t=JSON.parse(r.toString());e(t)}catch(n){Object(Z.b)(n)}}))}catch(t){Object(Z.b)(t),Q()}return()=>{try{B().unsubscribe()}catch(e){Object(Z.b)(e)}finally{Q()}}}),[r,e])},X=r(396),q=r.n(X),ee=r(1035);const te=c.a.createContext({debug:q.a,info:q.a,warning:q.a,error:q.a}),re=e=>{let{children:t}=e;const r=Object(x.a)().chatUser,n=H.a.getId(r),c=Object(ee.a)({category:"PROACTIVE_PROMPT",userId:n,batch:!0});return Object(i.jsx)(te.Provider,{value:c},t)},ne=()=>Object(n.useContext)(te);var ce=r(414);var ae=()=>{const{subscribe:e}=Object(I.a)(),t=Object(x.a)(),[r,c]=G(),a=ne(),s=Object(L.b)();Object(n.useEffect)((()=>{c({type:U,payload:{}})}),[c,t]);const i=Object(n.useCallback)((e=>{switch(e.payload.type){case z:c({type:w,payload:{variables:e.payload.variables}});break;case K:c({type:V,payload:{interceptIds:e.payload.interceptIds}})}}),[c]);return J(i,t),Object(n.useEffect)((()=>{const t=e("fetchCandidatePromptBaseOnUrlChange",(()=>{c({type:U,payload:{silent:!0}})}));return()=>{t&&t()}}),[c]),Object(n.useEffect)((()=>{const e=e=>{if(e.response&&e.response.data&&e.response.data.eventType===ce.a.USER_PROFILE_UPDATED.id)return c({type:U,payload:{silent:!0}})};return s.sprChat("subscribeToUpdate",{topic:"eventTriggered",subscriber:e}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"eventTriggered",subscriber:e})}}),[c]),Object(n.useEffect)((()=>{const e=b()(r,(e=>!P.a.getCreativeId(e)));o()(e)||a.debug(`Available intercepts : ${JSON.stringify(e)}`)}),[r]),[r,c]},se=r(114),ie=r.n(se),ue=r(566),oe=r(465);var le=e=>{const t=ne(),r=Object(n.useMemo)((()=>ie()(e,(e=>{let t=e;return P.a.getSnoozeConfig(e)&&(t=(e=>{const t=P.a.getFilter(e),r=P.a.getSnoozeConfig(e);if(o()(r))return e;const n={filterType:ue.a.LTE,field:oe.a.NUM_SNOOZE_ALLOWED,values:[r.maxSnoozeCount],details:{numSnoozes:r.maxSnoozeCount-r.currentSnoozeCount,nextSnoozeDuration:r.nextSnoozeDuration}};return t?{...e,filter:{filterType:ue.a.AND,filters:[n,t]}}:{...e,filter:n}})(t)),t}))),[e]);return Object(n.useEffect)((()=>{const e=b()(r,(e=>!P.a.getCreativeId(e)));o()(e)||t.debug(`Adapted intercepts : ${JSON.stringify(e)}`)}),[r]),r},be=r(1087),de=r.n(be),Oe=r(41),Te=r.n(Oe),Ee=r(490),ve=r.n(Ee);const _e=new Set([oe.a.IS_CONVERSATION_OPEN]),he="EXCLUDE_LIVE_CHAT_FILTERS",pe="INCLUDE_LIVE_CHAT_FILTERS",Ie=(e,t)=>{if(!o()(e)){if(e.filterType===ue.a.AND||e.filterType===ue.a.OR){if(o()(e.filters))return;const r=ve()(ie()(e.filters,(e=>Ie(e,t))));return o()(r)?void 0:{...e,filters:r}}return t===pe&&_e.has(e.field)||t===he&&!_e.has(e.field)?e:void 0}};var me=r(1010),je=r(388);var ge=()=>{const{subscribe:e,getValue:t}=Object(I.a)();return{subscribe:Object(n.useCallback)(((t,r)=>{const n=je.a.getId(t);return e(n,r)}),[e]),getValue:t}},Ce=r(395),fe=r.n(Ce),Se=r(412),ye=r.n(Se),Re=r(178),Ne=r.n(Re);var Ae=class{constructor(){this._startTime=void 0,this._endTime=void 0,this.start=()=>(this._startTime=this.getCurrentTime(),this._startTime),this.stop=()=>(this._endTime=this.getCurrentTime(),this._endTime),this.getCurrentTime=()=>Date.now(),this.getStartTime=()=>this._startTime,this.getEndTime=()=>this._endTime,this._startTime=0,this._endTime=0}};var Le=class{constructor(){this._clockInstance=void 0,this._totalTime=void 0,this.time=()=>(this._totalTime=this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime(),this._totalTime),this._clockInstance=new Ae,this._totalTime=0,this._clockInstance.start()}};var Pe=()=>Object(n.useCallback)((e=>{let{startTime:t,expectedTime:r,onTimeout:n}=e;const c=r-(t||Date.now());let a;return c>0&&(a=window.setTimeout((()=>{n()}),c)),a}),[]);var ke=()=>{const e=Pe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Le),[]);const r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=je.a.getId(n),s=e({startTime:t.current.time(),expectedTime:ye()(je.a.getValues(n)),onTimeout:c});return s&&(r.current={...r.current,[a]:{timeoutId:s}}),()=>{clearTimeout(Ne()(r.current,`${a}.timeoutId`)),r.current=fe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}},De=r(116),we=r.n(De);var Ve=class{constructor(){this._clockInstance=void 0,this._activeTime=void 0,this._visibilityChangeHandler=()=>{const{visibilityState:e}=document;"hidden"===e&&(this._clockInstance.stop(),this._activeTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime()),"visible"===e&&this._clockInstance.start()},this.time=()=>"hidden"===document.visibilityState?this._activeTime:this._activeTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Ae,"visible"===document.visibilityState&&this._clockInstance.start(),this._activeTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var Ue=()=>{const e=Pe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Ve),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{"visible"===document.visibilityState&&we()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:ye()(je.a.getValues(Ne()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})})),"hidden"===document.visibilityState&&we()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=je.a.getId(n);if("visible"===document.visibilityState){const s=e({startTime:t.current.time(),expectedTime:ye()(je.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return"hidden"===document.visibilityState&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ne()(r.current,`${a}.timeoutId`)),r.current=fe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};var Ge=class{constructor(){this._clockInstance=void 0,this._inactiveTime=void 0,this._visibilityChangeHandler=()=>{const{visibilityState:e}=document;"hidden"===e&&this._clockInstance.start(),"visible"===e&&(this._clockInstance.stop(),this._inactiveTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime())},this.time=()=>"visible"===document.visibilityState?this._inactiveTime:this._inactiveTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Ae,"hidden"===document.visibilityState&&this._clockInstance.start(),this._inactiveTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var xe=()=>{const e=Pe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Ge),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{"visible"===document.visibilityState&&we()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)})),"hidden"===document.visibilityState&&we()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:ye()(je.a.getValues(Ne()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=je.a.getId(n);if("hidden"===document.visibilityState){const s=e({startTime:t.current.time(),expectedTime:ye()(je.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return"visible"===document.visibilityState&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ne()(r.current,`${a}.timeoutId`)),r.current=fe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}},Me=r(1088),He=r.n(Me);var Fe=()=>{const e=Object(n.useRef)({}),t=Object(n.useContext)(v.a);return{subscribe:Object(n.useCallback)(((r,n)=>{const c=je.a.getId(r),a=ye()(je.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===k.a.ENGAGE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ne()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=fe()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>He()(t.getActionDetails(),(e=>e.variants.some((e=>e.actionState===k.a.ENGAGE))))),[])}};var We=()=>{const e=Object(n.useRef)({}),t=Object(n.useContext)(v.a);return{subscribe:Object(n.useCallback)(((r,n)=>{const c=je.a.getId(r),a=ye()(je.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===k.a.CLOSE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ne()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=fe()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>He()(t.getActionDetails(),(e=>e.variants.some((e=>e.actionState===k.a.CLOSE))))),[])}};var $e=()=>{const{getValue:e,subscribe:t}=Fe(),{getValue:r,subscribe:c}=We(),a=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,n,c)=>{const s=je.a.getId(t);switch(c&&je.a.getField(c)){case oe.a.INTERCEPT_CLOSED_IN_SESSION_KEY:{const e=r(),i=ye()(je.a.getValues(c)),u=()=>{const r=ye()(je.a.getValues(t)),c=e[i]?e[i].variants:[],u=c[c.length-1].actionTime,o=r-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};e[i]&&u();break}case oe.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:{const r=e(),i=ye()(je.a.getValues(c)),u=()=>{const e=ye()(je.a.getValues(t)),c=r[i]?r[i].variants:[],u=c[c.length-1].actionTime,o=e-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};r[i]&&u();break}}return()=>{ie()(a.current[s],(e=>e())),a.current=fe()(a.current,s)}}),[])}},Be=r(516),Qe=r.n(Be),Ze=r(553),Ye=r.n(Ze),ze=r(438);const Ke="HORIZONTAL",Je="VERTICAL",Xe=e=>{let{clientWindow:t,scrollDirection:r}=e;const n=t.document;let c,a;if(r===Ke){const e=n.documentElement.scrollWidth;c=n.documentElement.scrollLeft+n.documentElement.clientWidth,a=e?Math.round(c/e*100):100}else{const e=n.documentElement.scrollHeight;c=n.documentElement.scrollTop+n.documentElement.clientHeight,a=e?Math.round(c/e*100):100}return{scrollDepth:c,scrollPercent:a}},qe=e=>{const t=Object(ze.b)(),[r,c]=Object(n.useState)((()=>(e=>{let{clientWindow:t,scrollDirection:r}=e;return Object(ze.c)(t)?Xe({clientWindow:t,scrollDirection:r}):{scrollDepth:0,scrollPercent:0}})({clientWindow:t,scrollDirection:e})));return Object(n.useEffect)((()=>{if(Object(ze.c)(t)){const r=Ye()((()=>{const r=Xe({clientWindow:t,scrollDirection:e});c(r)}),1e3);return t.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",r)}}return q.a}),[]),r};var et=r(429),tt=r.n(et);var rt=()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=je.a.getId(t),{start:c,end:a}=Ne()(t,"details.range[0]");let s,i;const u=c,o=tt()(a)?-1:a;return u>0&&(s=window.setTimeout(r,u)),o>0&&(i=window.setTimeout(r,o)),e.current={...e.current,[n]:{...e.current[n],timeoutIdToGetInRange:s,timeoutIdToGetOutFromRange:i,timerStartTime:Date.now()}},()=>{clearTimeout(Ne()(e.current,`${n}.timeoutIdToGetInRange`)),clearTimeout(Ne()(e.current,`${n}.timeoutIdToGetOutFromRange`)),e.current=fe()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=je.a.getId(t),{start:n,end:c}=Ne()(t,"details.range[0]"),a=Ne()(e.current,`${r}.timerStartTime`),s=Date.now()-a;return tt()(n)||tt()(c)?tt()(n)||s>=n?0:1:s>=c?1:s>=n?0:1}),[])}};var nt=()=>{const{getValue:e,subscribe:t}=ge(),{getValue:r,subscribe:c}=ke(),{getValue:a,subscribe:s}=Ue(),{getValue:i,subscribe:u}=xe(),{getValue:o,subscribe:l}=We(),{getValue:b,subscribe:d}=Fe(),{subscribe:O}=$e(),{getValue:T,subscribe:E}=(()=>{const e=qe(Je),t=Object(n.useRef)({}),r=Object(n.useRef)(e);r.current=e,Qe()((()=>{ie()(t.current,(e=>{e()}))}),[e.scrollDepth,e.scrollPercent]);const c=Object(n.useCallback)(((e,r)=>{const n=je.a.getId(e);return t.current={...t.current,[n]:r},()=>{t.current=fe()(t.current,n)}}),[]);return{getValue:Object(n.useCallback)((()=>({scrollDepth:r.current.scrollDepth,scrollPercent:r.current.scrollPercent})),[]),subscribe:c}})(),{getValue:v,subscribe:_}=(()=>{const e=qe(Ke),t=Object(n.useRef)({}),r=Object(n.useRef)(e);r.current=e,Qe()((()=>{ie()(t.current,(e=>{e()}))}),[e.scrollDepth,e.scrollPercent]);const c=Object(n.useCallback)(((e,r)=>{const n=je.a.getId(e);return t.current={...t.current,[n]:r},()=>{t.current=fe()(t.current,n)}}),[]);return{getValue:Object(n.useCallback)((()=>({scrollDepth:r.current.scrollDepth,scrollPercent:r.current.scrollPercent})),[]),subscribe:c}})(),{getValue:h,subscribe:p}=(()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=je.a.getId(t),c=ye()(je.a.getValues(t));let a;return c>0&&(a=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current.id,timeLeft:0}},r()}),c)),e.current={...e.current,[n]:{timeoutId:a,timeLeft:c}},()=>{window.clearTimeout(Ne()(e.current,`${n}.timeoutId`)),e.current=fe()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=je.a.getId(t);return Ne()(e.current,`${r}.timeLeft`,0)}),[])}})(),{getValue:I,subscribe:m}=(()=>{const e=Pe(),t=Object(n.useRef)(new Le),r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=je.a.getId(n),s=Ne()(je.a.getDetails(n),"nextSnoozeDuration",0),i=t.current.time(),u=e({startTime:i,expectedTime:i+s,onTimeout:()=>{r.current={...r.current,[a]:{...r.current.id,timeLeft:0}},c()}});return u&&(r.current={...r.current,[a]:{timeoutId:u,timeLeft:s}}),()=>{clearTimeout(Ne()(r.current,`${a}.timeoutId`)),r.current=fe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>e=>{const t=je.a.getId(e);return Ne()(r.current,`${t}.timeLeft`,0)}),[])}})(),{getValue:j,subscribe:g}=rt();return{getValue:Object(n.useCallback)((()=>({[oe.a.CURRENT_URL]:e(),[oe.a.TOTAL_TIME_SPENT]:r(),[oe.a.ACTIVE_TIME_SPENT]:a(),[oe.a.INACTIVE_TIME_SPENT]:i(),[oe.a.INTERCEPT_ENGAGED_IN_SESSION_KEY]:b(),[oe.a.INTERCEPT_CLOSED_IN_SESSION_KEY]:o(),[oe.a.VERTICAL_PAGE_SCROLL_DEPTH]:T(),[oe.a.HORIZONTAL_PAGE_SCROLL_DEPTH]:v(),[oe.a.TIME_SPENT_ON_SESSION]:h(),[oe.a.NUM_SNOOZE_ALLOWED]:I(),[oe.a.BUSINESS_HOURS]:j()})),[e,r,a,i,o,b,T,v,h,I,j]),subscribe:Object(n.useCallback)(((e,r,n)=>{switch(je.a.getField(e)){case oe.a.TOTAL_TIME_SPENT:return c(e,r);case oe.a.CURRENT_URL:return t(e,r);case oe.a.ACTIVE_TIME_SPENT:return s(e,r);case oe.a.INACTIVE_TIME_SPENT:return u(e,r);case oe.a.INTERCEPT_CLOSED_IN_SESSION_KEY:return l(e,r);case oe.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:return d(e,r);case oe.a.DEPENDENT_DURATION_KEY:return O(e,r,n);case oe.a.VERTICAL_PAGE_SCROLL_DEPTH:return E(e,r);case oe.a.HORIZONTAL_PAGE_SCROLL_DEPTH:return _(e,r);case oe.a.TIME_SPENT_ON_SESSION:return p(e,r);case oe.a.NUM_SNOOZE_ALLOWED:return m(e,r);case oe.a.BUSINESS_HOURS:return g(e,r);default:return q.a}}),[t,c,s,u,l,d,O,E,_,p,m,g])}},ct=r(389);var at=(e,t)=>{const{_getStaticValueMap:r=q.a}=t||ct.a,{getValue:c,subscribe:a}=nt(),s=Object(n.useCallback)((()=>({...r(),...c()})),[c,r]);return Object(me.a)(e,{...t,getValue:s,subscribe:a})},st=r(486),it=r.n(st);var ut=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Object(L.b)();return Object(n.useMemo)((()=>{o()(e)?c.current=[{hasPassed:!0}]:c.current=ie()(e,(e=>{let{id:t,filter:r}=e;const n=o()(r)||a.current[t];return delete a.current[t],{hasPassed:n}}))}),[e]),Object(n.useEffect)((()=>{if(!o()(ve()(ie()(e,"filter")))){const t=it.a.v4(),n=t=>{let{response:n}=t;n&&n.data&&(c.current=ie()(e,((e,t)=>{let{id:r,filter:c}=e;return a.current[r]=!c||n.data.results[t],{hasPassed:a.current[r]}})),r((e=>e+1)))};return s.sprChat("subscribeToUpdate",{topic:"addFilterToEvaluate",subscriber:n}),s.sprChat("addFilterToEvaluate",{id:t,filters:ie()(e,"filter")}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"addFilterToEvaluate",subscriber:n}),s.sprChat("removeFilterToEvaluate",{id:t})}}}),[e]),c.current};var ot=e=>{const t=Object(n.useRef)([]),r=ne(),{interceptsWithoutLiveChatFilterToEvaluate:c,interceptsOnlyWithLiveChatFilterToEvaluate:a}=Object(n.useMemo)((()=>Te()(e,((e,t)=>{const r=Ie(P.a.getFilter(t),he),n=Ie(P.a.getFilter(t),pe);return{interceptsWithoutLiveChatFilterToEvaluate:[...e.interceptsWithoutLiveChatFilterToEvaluate,r],interceptsOnlyWithLiveChatFilterToEvaluate:[...e.interceptsOnlyWithLiveChatFilterToEvaluate,{id:P.a.getId(t),filter:n}]}}),{interceptsWithoutLiveChatFilterToEvaluate:[],interceptsOnlyWithLiveChatFilterToEvaluate:[]})),[e]),s=at(c,{defaultValue:!0}),i=ut(a);return Object(n.useMemo)((()=>{t.current=[],ie()(e,((e,r)=>{s[r].hasPassed&&i[r].hasPassed&&(t.current=[...t.current,e])}))}),[s,i,e]),Object(n.useEffect)((()=>{const e=b()(t.current,(e=>!P.a.getCreativeId(e)));o()(e)||r.debug(`filterPassedIntercepts : ${JSON.stringify(e)}`)}),[t.current]),t.current},lt=r(538);const bt=(e,t)=>t?Te()(P.a.getTargets(e),((e,r,n)=>({...e,[n]:{...r,additional:t[r.value]}})),{}):P.a.getTargets(e);var dt=r(425);const Ot="/livechat/prompt";async function Tt(e){return(await dt.a.post(`${Ot}/creative/${e}`,void 0,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data}async function Et(e){return(await dt.a.post(`${Ot}/fetch/survey`,{p:e},{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data}const vt=["snoozeConfig"];var _t=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=ne();return Object(n.useMemo)((()=>{c.current=[],ie()(e,(e=>{if(!e)return;if(!P.a.getCreativeId(e))return void s.debug(`Intercept resolver : ${JSON.stringify(e)}`);if(!o()(a.current[P.a.getId(e)]))return void c.current.push({...e,...fe()(a.current[P.a.getId(e)],vt)});const t=(e=>{const t=P.a.getId(e),r=Te()(P.a.getTargets(e),((e,t)=>t.type===lt.a.SURVEY||t.type===lt.a.SURVEY_INLINE?{...e,surveyURLs:e.surveyURLs?[...e.surveyURLs,t.value]:[t.value]}:e),{});return o()(r)?void 0:{...r,variantId:t}})(e);Promise.all([Tt(P.a.getCreativeId(e)),t?Et(t):Promise.resolve(void 0)]).then((t=>{let[n,s]=t;const i={...e,creative:n,targets:bt(e,s)};a.current[P.a.getId(e)]=i,c.current=[...c.current,i],r((e=>e+1))})).catch((e=>{Object(Z.b)(e)}))}))}),[e,r]),c.current};var ht=e=>{const t=Object(n.useRef)([]),r=ot(e),c=_t(r);return Object(n.useMemo)((()=>{t.current=O()([...de()(t.current,c,"id"),...c],"id")}),[c]),t.current},pt=r(631);const It=new Set([lt.a.LIVE_CHAT_EXECUTE_RULE,lt.a.LIVE_CHAT_ROUTE_TO_BOT,lt.a.LIVE_CHAT_WITH_AGENT,lt.a.CHAT_WITH_AGENT,lt.a.ROUTE_TO_BOT,lt.a.EXECUTE_RULE]);var mt=e=>{const[t,r]=Object(n.useState)([]),c=Object(L.b)();return Object(n.useEffect)((()=>{const t=t=>{const n=t?e:(e=>Te()(e,((e,t)=>{let r=!1;return we()(P.a.getTargets(t),(e=>{if(It.has(pt.a.getType(e)))return r=!0,!1})),r?e:[...e,t]}),[]))(e);r((e=>O()([...de()(e,n,"id"),...n],"id")))};return c.sprChat("onAvailabilityChange",t),()=>{c.sprChat("offAvailabilityChange",t)}}),[r,e,c]),t};const jt="REMOVE_INTERCEPT";var gt=function(){const[e,t]=ae(),r=le(e),c=ht(r);return[mt(c),Object(n.useCallback)((e=>{e.type===jt&&t({type:V,payload:{interceptIds:[e.payload.interceptId]}})}),[])]},Ct=r(372),ft=r(852),St=r(382);const yt="POPUP",Rt="LIVECHAT",Nt="POSITIONED_POPUP",At=Object(St.a)((()=>r.e(46).then(r.bind(null,1882)))),Lt=Object(St.a)((()=>r.e(47).then(r.bind(null,1871)))),Pt=Object(St.a)((()=>r.e(41).then(r.bind(null,1883)))),kt=new Set([yt,Rt,Nt]),Dt=e=>{const{intercepts:t}=e,r=Object(n.useMemo)((()=>Te()(t,((e,t)=>{const r=ft.a.getType(P.a.getCreative(t));return kt.has(r)&&e[r].push(t),e}),{[yt]:[],[Rt]:[],[Nt]:[]})),[t]),a=r[yt],s=r[Nt],u=r[Rt];return Object(i.jsx)(c.a.Fragment,null,o()(a)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(At,Object(Ct.a)({},e,{intercepts:a}))),o()(u)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Pt,Object(Ct.a)({},e,{intercepts:u}))),o()(s)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Lt,Object(Ct.a)({},e,{intercepts:s}))))};var wt=c.a.memo(Dt);var Vt=()=>{const[e,t]=gt(),r=Object(n.useCallback)((e=>{t({type:jt,payload:{interceptId:e}})}),[t]);return o()(e)?null:Object(i.jsx)(wt,{intercepts:e,onClose:r})},Ut=r(853),Gt=r(1037);var xt=function(e){const t=Object(Gt.a)(e.window);return Object(i.jsx)(Ut.a.Provider,{value:t},e.children)},Mt=r(1086);var Ht=class{constructor(){this._map=void 0,this._map={}}addEntry(e){this._map[e]||(this._map[e]={subscribers:[],variants:[]})}setAction(e,t){const r=(e=>{const t=e.indexOf("_");return-1!==t?e.substring(0,t):e})(e),n=Date.now();this.addEntry(r),this._map[r].variants=[...this._map[r].variants,{actionState:t,actionTime:n,id:e}],this._map[r].subscribers.forEach((e=>{e(t)})),this._map[r].subscribers=[]}setSubscriber(e,t){return this.addEntry(e),this._map[e].subscribers.push(t),()=>{this._map[e].subscribers=this._map[e].subscribers.filter((e=>e!==t))}}getActionState(e,t){const r=this._map[e]&&this._map[e].variants;if(r&&r.length){const e=r.find((e=>e.id===t));return t?e&&e.actionState:r[r.length-1].actionState}}getActionDetails(){return this._map}};var Ft=()=>Object(n.useRef)(new Ht).current,Wt=r(623);const $t=e=>{const t=Object(L.b)(),r=Ft(),c=Object(n.useMemo)((()=>Object(Wt.a)(t.document)),[t.document]);return Object(i.jsx)(i.CacheProvider,{value:c},Object(i.jsx)(xt,{window:t},Object(i.jsx)(Mt.a.Provider,{value:e.handshakeDetails},Object(i.jsx)(v.a.Provider,{value:r},Object(i.jsx)(re,null,Object(i.jsx)(Vt,null))))))};var Bt=c.a.memo($t),Qt=r(1008);function Zt(e,t){const r=Object(Qt.a)();s.a.render(Object(i.jsx)(Bt,{handshakeDetails:t}),r)}},467:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={PAGE_VISIT:"PAGE_VISIT",TAB_CHANGE:"TAB_CHANGE",TAB_CLOSE:"TAB_CLOSE",INTERCEPT_SNOOZE_TRIGGERED:"INTERCEPT_SNOOZE_TRIGGERED",INTERCEPT_TRIGGERED:"INTERCEPT_TRIGGERED",INTERCEPT_CLOSED:"INTERCEPT_CLOSED",INTERCEPT_ENGAGED:"INTERCEPT_ENGAGED",SNOOZE:"SNOOZE",INTERCEPT_TRIGGERED_IN_BACKGROUND:"INTERCEPT_TRIGGERED_IN_BACKGROUND",INTERCEPT_AUTO_CLOSED:"INTERCEPT_AUTO_CLOSED"}},469:function(e,t,r){"use strict";var n=r(365),c=r(514),a=r.n(c);const s="DATA_LOADING",i="DATA_LOADED",u="DATA_UPDATED",o="DATA_LOAD_FAILED",l="DATA_FETCHING_MORE",b={loading:!1,error:void 0,data:void 0},d=(e,t)=>{switch(t.type){case s:return{...e,loading:!0,data:void 0,error:void 0};case l:return{...e,loading:!0,error:void 0};case i:return{...e,loading:!1,data:t.payload};case o:return{...e,loading:!1,error:t.payload};case u:return{...e,data:t.payload};default:return e}};var O=()=>Object(n.useReducer)(d,b),T=r(406),E=r(425);const v=(e,t)=>t!==e.current;t.a=e=>{let{query:t,skipQueryOnMount:r,payload:c,onCompleted:b,options:d}=e;const[_,h]=O(),{loading:p,data:I,error:m}=_,j=Object(n.useRef)(null),g=Object(n.useRef)(I);g.current=I;const C=T.a.getType(t),f=T.a.getUrl(t),S=Object(n.useRef)(b);S.current=b;const y=Object(n.useCallback)((()=>{j.current=null}),[]),R=Object(n.useCallback)((async(e,t)=>{var r;y(),j.current=t;const n=await("application/x-www-form-urlencoded"===(null===d||void 0===d||null===(r=d.headers)||void 0===r?void 0:r["Content-Type"])&&e?E.a[C](f,{p:e},d):E.a[C](f,e,d));if(!v(j,t))return S.current&&S.current(n.data),n}),[C,f]),N=Object(n.useCallback)((async e=>{h({type:s,payload:{}});const t=a()("reqId");try{const r=await R(e,t);v(j,t)||h({type:i,payload:r.data})}catch(r){v(j,t)||h({type:o,payload:r})}}),[R]);Object(n.useEffect)((()=>{r||N(c)}),[]);const A=Object(n.useCallback)((async(e,t)=>{h({type:l,payload:{}});const r=a()("reqId");try{const n=await R(e,r);if(!v(j,r)){let e=n.data;t&&(e=t(g.current,n.data)),h({type:i,payload:e})}}catch(n){v(j,r)||h({type:o,payload:n})}}),[R]),L=Object(n.useCallback)(((e,t)=>{t?A(e,t):N(e)}),[N]),P=Object(n.useCallback)((e=>{h({type:u,payload:e(g.current)})}),[]);return{loading:p,data:I,error:m,refetch:L,fetchMore:A,updateQuery:P}}},477:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));var n=r(1889),c=r(1885),a=r(1802);const s=Object(n.a)("id"),i=Object(n.a)("creativeId"),u=Object(n.a)("targets"),o=Object(c.a)(["creative","socialAsset","content"]),l=Object(n.a)("settings"),b=Object(n.a)("filter"),d=Object(n.a)("snoozeConfig"),O=Object(c.a)(["additional","surveyResponseId"]);class T{}T.getId=Object(a.a)(s),T.getCreativeId=Object(a.a)(i),T.getTargets=Object(a.a)(u),T.getCreative=Object(a.a)(o),T.getFilter=Object(a.a)(b),T.getSettings=Object(a.a)(l),T.getSnoozeConfig=Object(a.a)(d),T.getSurveyResponseId=Object(a.a)(O)},507:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={CLOSE:"CLOSE",ENGAGE:"ENGAGE",TRIGGERED:"TRIGGERED",SNOOZE:"SNOOZE"}},537:function(e,t,r){"use strict";var n=r(365);const c=r.n(n).a.createContext(void 0);t.a=c},538:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={LIVE_CHAT_ROUTE_TO_BOT:"LIVE_CHAT_ROUTE_TO_BOT",LIVE_CHAT_EXECUTE_RULE:"LIVE_CHAT_EXECUTE_RULE",LIVE_CHAT_WITH_AGENT:"LIVE_CHAT_WITH_AGENT",CLOSE:"CLOSE",SURVEY:"SURVEY",SURVEY_INLINE:"SURVEY_INLINE",CHAT_WITH_AGENT:"CHAT_WITH_AGENT",ROUTE_TO_BOT:"ROUTE_TO_BOT",EXECUTE_RULE:"EXECUTE_RULE",REMOVE:"REMOVE",SNOOZE:"SNOOZE",URL:"OPEN_URL"}},586:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(365);const c=()=>{const[e,t]=Object(n.useState)("visible"===document.visibilityState);return Object(n.useEffect)((()=>{const e=()=>{const{visibilityState:e}=document;"hidden"===e&&t(!1),"visible"===e&&t(!0)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),e}},630:function(e,t,r){"use strict";var n=r(365),c=r(74),a=r.n(c),s=r(527),i=r.n(s),u=r(460),o=r.n(u),l=r(469),b=r(586),d=r(851),O=r(406),T=r(437),E=r(415),v=r(467);const _=(new O.a).setUrl("/livechat/prompt/browse/event").setType(E.a.POST).build(),h=(()=>{const e={};return{set:(t,r)=>{e[r]=t},get:t=>e[t],push:(t,r)=>{var n;e[r]=[...null!==(n=e[r])&&void 0!==n?n:[],...o()(t)]}}})();t.a=function(){let{skipQueryOnMount:e,payload:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipQueryOnMount:!1};const{refetch:r,...c}=Object(l.a)({query:_,skipQueryOnMount:e,payload:{...t,sourceType:"PROACTIVE_PROMPT"},options:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),s=Object(d.a)(),u=s.chatUser.userId,o=Object(b.a)(),O=Object(n.useRef)(o);O.current=o;const E=Object(n.useCallback)((e=>{const t={...e,sourceType:"PROACTIVE_PROMPT",page:Object(T.a)().pageUrl,userAgent:Object(T.a)().userAgent,timeZone:Object(T.a)().timeZone};if(O.current)r(t);else if(t.eventType===v.a.INTERCEPT_AUTO_CLOSED){const e=i()(h.get(u),(e=>e.eventId===t.eventId&&e.eventType===v.a.INTERCEPT_TRIGGERED));-1!==e&&h.get(u).splice(e,1),h.push(t,u)}else t.eventType===v.a.INTERCEPT_TRIGGERED&&r({...t,eventType:v.a.INTERCEPT_TRIGGERED_IN_BACKGROUND}),h.push(t,u)}),[r,u]);return Object(n.useEffect)((()=>{o&&!a()(h.get(u))&&window.setTimeout((()=>{a()(h.get(u))||(r(h.get(u)),h.set([],u))}),0)}),[o]),{...c,refetch:E}}},631:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(1889),c=r(1802);const a=Object(n.a)("type"),s=Object(n.a)("value"),i=Object(n.a)("additional");class u{}u.getType=Object(c.a)(a),u.getValue=Object(c.a)(s),u.getAdditional=Object(c.a)(i)},851:function(e,t,r){"use strict";var n=r(365),c=r(1086);t.a=()=>Object(n.useContext)(c.a)},852:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(1889),c=r(1802);const a=Object(n.a)("type");class s{}s.getType=Object(c.a)(a)},853:function(e,t,r){"use strict";var n=r(365);const c=r.n(n).a.createContext({height:0,width:0});t.a=c}}]);